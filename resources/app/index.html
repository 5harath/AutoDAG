<title>DAG File Creator</title>
<link rel="stylesheet" href="css/bootstrap.min.css">
<link rel="stylesheet" href="css/bootstrap-theme.min.css">
<style>
table{counter-reset:rowNumber-1}
table tr{counter-increment:rowNumber}
table tr:not(#editing) td:first-child::before{content:counter(rowNumber);min-width:1em;margin-right:.5em;color:grey;font-weight:700}
</style>
<div style="width:95%; margin: auto;">
<h3>DAG File Creator</h3>
    <div id="dvData">
        <table class="table" id="makeEditable">
            <thead>
                <tr id="editing">
                    <th>Parent Task</th>
                    <th>Child Task</th>
                    <th style="width: 0.1em;">Email</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
        <span style="float:right"><button id="but_add" class="btn btn-sm btn-success">Add New Row</button></span><br></br>
    </div>
    <form>
        <div class="form-group">
            <label for="failemail">On Fail Email Address:</label>
            <input class="form-control input-sm" type="text" id="inputFailEmail">
        </div>
        <div class="form-group">
            <label for="dagname">DAG Name:</label>
            <input class="form-control input-sm" type="text" id="inputDAGName" placeholder="untitled_auto_dag">
        </div>
        <div class="form-group">
            <label for="dirpath">Directory Path:</label>
            <input class="form-control input-sm" type="text" id="inputPath">
        </div>
        <div class="form-group">
            <label for="airdirpath">Airflow Script Path:</label>
            <input class="form-control input-sm" type="text" id="inputAirPath">
        </div>
        <h5><b>Send Email</b></h5>
    </form>
    <script type="text/javascript">
	$(document).ready(function() {
        var t = $("#add_button"),
            e = $(".field_wrapper"),
            a = 0,
            i = "";
        $(t).click(function() {
        $(document).ready(function() {
            var t1 = $("#add_attach_button"+(a-1)),
                e1 = $(".field_wrapper .field_wrapper_inside"+(a-1)),
                a1 = 0,
                i1 = "";
            $(t1).click(function() {
                a1 < 100 && (i1 = '<div><input class="form-control input-sm" type="file" id="att'+(a-1)+'-'+a1+'"></input><br/><a href="javascript:void(0);" class="btn btn-sm btn-danger" id="remove_button"><span class="glyphicon glyphicon-minus"></span> Remove</a><br/><br/></div>', a1++, $(e1).append(i1))
            }), $(e1).on("click", "#remove_button", function(t1) {
                t1.preventDefault(), $(this).parent("div").remove(), a1--
            })
        })
            a < 100 && (i = '<div> <div class="form-group"> <label for="taskname">Task Name</label> (It is same as in the task table) <input class="form-control input-sm" type="text" id="emailtaskid' + a + '"></input> </div><div class="form-group"> <label for="emailtolab">To</label> <input class="form-control input-sm" type="text" id="emailto' + a + '"></input> </div> <div class="form-group"> <label for="sublab">Subject</label> <input class="form-control input-sm" type="text" id="emailsubject' + a + '"></input> </div> <div class="form-group"> <textarea style="height:150px;" class="form-control input-sm" type="text" id="emailcontent' + a + '" cols="50"></textarea> </div><div class="field_wrapper_inside' + a + '"></div><a href="javascript:void(0);" class="btn btn-sm btn-success" id="add_attach_button' + a + '" title="Add task"><span class="glyphicon glyphicon-plus"></span> Add more attachment</a><br></br><a href="javascript:void(0);" class="btn btn-sm btn-danger" id="remove_button"><span class="glyphicon glyphicon-minus"></span> Remove</a><br></br></div>', a++, $(e).append(i))
        }), $(e).on("click", "#remove_button", function(t) {
            t.preventDefault(), $(this).parent("div").remove(), a--
        })
    });
    </script>
    <script>
	window.$ = window.jQuery = require("./jquery-3.2.1.min.js");
	window.$ = window.jQuery = require("./main.js");
    </script>
    <div class="field_wrapper">
    </div>
    <a href="javascript:void(0);" class="btn btn-sm btn-success" id="add_button" title="Add task">Add email task</a><br></br>
    <span><button id="but_dag" class="btn btn-sm btn-default" onclick="saveDAGFile()">Save DAG Script</button></span>
    <div>
        <br />
    </div>
</div>
